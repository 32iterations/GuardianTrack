<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>GuardianTrack - åœ°ç†åœæ¬„</title>
    <!-- Leaflet.js CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/style.css">
    <style>
        /* ç¢ºä¿åœ°åœ–å¡«æ»¿æ¡†æ¶ */
        #map-container {
            height: 100%;
            width: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }
        #map {
            height: 100%;
            width: 100%;
            z-index: 10;
        }
        /* ç¾åŒ– Leaflet æ§åˆ¶é … */
        .leaflet-control-zoom {
            border: none !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        .leaflet-control-zoom a {
            background-color: white !important;
            color: #333 !important;
        }
        .leaflet-popup-content-wrapper {
            border-radius: 8px;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">

    <!-- æ‰‹æ©Ÿ UI æ¡†æ¶ -->
    <div class="w-full max-w-sm h-[800px] bg-gray-100 rounded-3xl shadow-2xl overflow-hidden flex flex-col border-4 border-black">
        
        <!-- ä¸»è¦å…§å®¹å€åŸŸ (åœ°åœ–å’Œæµ®å‹•UI) -->
        <main class="flex-1 relative">
            
            <!-- åœ°åœ–å®¹å™¨ -->
            <div id="map-container">
                <div id="map"></div>
            </div>

            <!-- æµ®å‹•é ‚éƒ¨å°è¦½åˆ— -->
            <header class="absolute top-0 left-0 right-0 p-4 z-20">
                <div class="bg-white/80 backdrop-blur-md rounded-xl shadow-md p-3 flex items-center justify-between">
                    <a href="./index.html" class="p-2 rounded-full hover:bg-gray-200">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
                    </a>
                    <h1 class="text-base font-bold text-gray-800">åœ°ç†åœæ¬„ï¼š<span class="text-purple-600">é™³ç§€è‹±</span></h1>
                    <div class="w-10 h-10"></div> <!-- ä½”ä½ç¬¦ -->
                </div>
            </header>
            
            <!-- æµ®å‹•åº•éƒ¨è³‡è¨Šèˆ‡æ§åˆ¶é¢æ¿ -->
            <div class="absolute bottom-0 left-0 right-0 p-4 z-20">
                <div class="bg-white rounded-2xl shadow-lg p-4 space-y-4">
                    <!-- å·²è¨­å®šåœæ¬„åˆ—è¡¨ -->
                    <div>
                        <h3 class="font-bold text-gray-800">å·²è¨­å®šçš„å®‰å…¨å€åŸŸ</h3>
                        <div id="geofence-list" class="mt-2 space-y-2">
                            <!-- é è¨­çš„ "å®¶" -->
                            <div class="bg-gray-100 rounded-lg p-3 flex justify-between items-center">
                                <div>
                                    <p class="font-semibold text-gray-700">ğŸ“ å®¶</p>
                                    <p class="text-xs text-gray-500">åŠå¾‘ï¼š200 å…¬å°º</p>
                                </div>
                                <button class="text-xs text-red-500 font-semibold">ç§»é™¤</button>
                            </div>
                        </div>
                    </div>

                    <!-- æ™ºæ…§æ¨è–¦ -->
                    <div class="border-t pt-4">
                        <h3 class="font-bold text-gray-800">æ™ºæ…§æ¨è–¦</h3>
                        <p class="text-xs text-gray-500 mb-2">æ ¹æ“šé•·è€…ç¿’æ…£ï¼Œå¿«é€Ÿæ–°å¢å¸¸ç”¨åœ°é»</p>
                        <div id="recommendations" class="flex flex-wrap gap-2">
                            <button data-lat="24.8049" data-lng="120.9719" data-name="æ–°ç«¹å…¬åœ’" class="bg-green-100 text-green-800 text-sm font-semibold px-3 py-1.5 rounded-full hover:bg-green-200 transition-colors">+ æ–°ç«¹å…¬åœ’</button>
                            <button data-lat="24.7981" data-lng="120.9701" data-name="ç«¹è“®å¸‚å ´" class="bg-orange-100 text-orange-800 text-sm font-semibold px-3 py-1.5 rounded-full hover:bg-orange-200 transition-colors">+ ç«¹è“®å¸‚å ´</button>
                            <button data-lat="24.8143" data-lng="120.9723" data-name="å°å¤§é†«é™¢" class="bg-blue-100 text-blue-800 text-sm font-semibold px-3 py-1.5 rounded-full hover:bg-blue-200 transition-colors">+ å°å¤§é†«é™¢</button>
                        </div>
                    </div>

                    <!-- è‡ªè¨‚æ–°å¢ -->
                     <div class="border-t pt-4">
                        <h3 class="font-bold text-gray-800">è‡ªè¨‚æ–°å¢</h3>
                         <div class="flex gap-2 mt-2">
                            <input type="text" id="custom-address" placeholder="è¼¸å…¥åœ°å€æˆ–é»æ“Šåœ°åœ–" class="flex-grow border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                            <button id="add-custom-btn" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">æ–°å¢</button>
                         </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Leaflet.js JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <script>
        // --- è®Šæ•¸å®šç¾© ---
        const homeCoords = [24.8088, 120.9718]; // é™³ç§€è‹±å®¶ (æ°‘ç”Ÿè·¯)
        const mapCenter = homeCoords;

        let map;
        let geofences = {}; // å­˜æ”¾åœ°åœ–ä¸Šçš„åœæ¬„åœ–å±¤

        // --- åˆå§‹åŒ–å‡½å¼ ---
        function initializeMap() {
            map = L.map('map', { zoomControl: false }).setView(mapCenter, 16);
            L.control.zoom({ position: 'bottomright' }).addTo(map);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19, attribution: 'Â© OpenStreetMap' }).addTo(map);

            // é è¨­åŠ ä¸Š "å®¶" çš„åœæ¬„
            addGeofence('å®¶', homeCoords, 200);
        }

        // --- åŠŸèƒ½å‡½å¼ ---
        function addGeofence(name, coords, radius) {
            // å¦‚æœå·²å­˜åœ¨åŒååœæ¬„ï¼Œå…ˆç§»é™¤èˆŠçš„
            if (geofences[name]) {
                map.removeLayer(geofences[name].marker);
                map.removeLayer(geofences[name].circle);
            }

            const marker = L.marker(coords).addTo(map)
                .bindPopup(`<b>${name}</b><br>å®‰å…¨å€åŸŸåŠå¾‘: ${radius}å…¬å°º`).openPopup();

            const circle = L.circle(coords, {
                color: '#8b5cf6',
                fillColor: '#a78bfa',
                fillOpacity: 0.3,
                radius: radius
            }).addTo(map);

            geofences[name] = { marker, circle };
            map.flyTo(coords, 16);
            updateGeofenceList();
        }

        function removeGeofence(name) {
            if (geofences[name]) {
                map.removeLayer(geofences[name].marker);
                map.removeLayer(geofences[name].circle);
                delete geofences[name];
                updateGeofenceList();
            }
        }
        
        function updateGeofenceList() {
            const listContainer = document.getElementById('geofence-list');
            listContainer.innerHTML = ''; // æ¸…ç©ºåˆ—è¡¨

            if (Object.keys(geofences).length === 0) {
                 listContainer.innerHTML = '<p class="text-sm text-gray-500">å°šæœªè¨­å®šä»»ä½•å®‰å…¨å€åŸŸã€‚</p>';
                 return;
            }

            for (const name in geofences) {
                const fence = geofences[name];
                const radius = fence.circle.getRadius();
                const listItem = document.createElement('div');
                listItem.className = 'bg-gray-100 rounded-lg p-3 flex justify-between items-center';
                listItem.innerHTML = `
                    <div>
                        <p class="font-semibold text-gray-700">ğŸ“ ${name}</p>
                        <p class="text-xs text-gray-500">åŠå¾‘ï¼š${radius} å…¬å°º</p>
                    </div>
                    <button class="text-xs text-red-500 font-semibold remove-btn" data-name="${name}">ç§»é™¤</button>
                `;
                listContainer.appendChild(listItem);
            }

            // é‡æ–°ç¶å®šç§»é™¤æŒ‰éˆ•äº‹ä»¶
            document.querySelectorAll('.remove-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const nameToRemove = e.target.getAttribute('data-name');
                    removeGeofence(nameToRemove);
                });
            });
        }


        // --- äº‹ä»¶ç›£è½ ---
        document.addEventListener('DOMContentLoaded', () => {
            initializeMap();
            
            // æ¨è–¦æŒ‰éˆ•äº‹ä»¶
            document.getElementById('recommendations').addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') {
                    const lat = parseFloat(e.target.dataset.lat);
                    const lng = parseFloat(e.target.dataset.lng);
                    const name = e.target.dataset.name;
                    addGeofence(name, [lat, lng], 300); // é è¨­åŠå¾‘300å…¬å°º
                }
            });

            // è‡ªè¨‚æ–°å¢æŒ‰éˆ• (ç›®å‰åƒ…ç‚ºç¤ºæ„)
            document.getElementById('add-custom-btn').addEventListener('click', () => {
                const address = document.getElementById('custom-address').value;
                if(address) {
                    alert(`å°‡æœƒæ–°å¢åœ°å€ç‚º "${address}" çš„åœæ¬„ã€‚\n(æ­¤ç‚ºç¤ºæ„åŠŸèƒ½ï¼Œå¯¦éš›éœ€ä¸²æ¥åœ°ç†ç·¨ç¢¼API)`);
                } else {
                    alert('è«‹å…ˆè¼¸å…¥åœ°å€æˆ–åœ¨åœ°åœ–ä¸Šé¸å–ä½ç½®ã€‚');
                }
            });

             // ç›£è½åœ°åœ–é»æ“Š
            map.on('click', function(e) {
                const lat = e.latlng.lat.toFixed(5);
                const lng = e.latlng.lng.toFixed(5);
                document.getElementById('custom-address').value = `åº§æ¨™: ${lat}, ${lng}`;
            });
        });
    </script>
</body>
</html>


http://googleusercontent.com/immersive_entry_chip/0
